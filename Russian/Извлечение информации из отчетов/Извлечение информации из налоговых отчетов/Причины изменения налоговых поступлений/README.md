### Описание
Правило ищет причину изменения налоговых поступлений.

### Примеры найденных сущностей
* **По транспортному налогу – рост поступлений** в бюджет к уровню поступлений первого квартала 2020 года на **16,9 %** или на **1,4 млн. рублей обусловлен уплатой задолженности по юридическим лицам за прошлый год**.
* **По земельному налогу - рост поступлений на 24,9 %** или на **1,7 млн. рублей** к аналогичному периоду прошлого года **связан с погашенной задолженностью прошлых лет**. 

### Инструкция
* Создать новый проект в платформе [PolyAnalyst](https://www.megaputer.ru/produkti/)
* Загрузить в проект файл [**Данные_Причины изменения налоговых поступлений.txt**](<Данные_Причины изменения налоговых поступлений.txt>)
* Импортировать словарь [**WordClasses_Динамика.pad7**](<../Динамика налоговых поступлений/WordClasses_Динамика.pad7>) в **Менеджере словарей**
* Добавить узел **Извлечение сущностей**, в настройках узла:
	 * отключить все стандартные сущности, кроме сущности **Currencies** (Валюты)
	 * создать новую пользовательскую сущность
	 * открыть **Редактор правил** новой сущности и скопировать в него правило [**Налог.txt**](../Налог/Налог.txt)
	 * выполнить узел
* Добавить узел **Извлечение сущностей**, в настройках узла:
	 * отключить стандартные сущности
	 * на вкладке **Словари** подключить словарь **WordClasses Динамика**
	 * создать новую пользовательскую сущность
	 * открыть **Редактор правил** новой сущности и скопировать в него правило [**Динамика_налога.txt**](<../Динамика налоговых поступлений/Динамика_налога.txt>)
	 * выполнить узел
* Добавить еще один узел **Извлечение сущностей**, в настройках узла:
	 * отключить стандартные сущности
	 * создать новую пользовательскую сущность
	 * открыть **Редактор правил** новой сущности и скопировать в него правило [**Причины изменения налоговых поступлений.txt**](<Причины изменения налоговых поступлений.txt>):
	 ```  
		rule: Причины_изменений 
		{
			query: {entity(Динамика)}:dynamics
		
			rule: В_предложении
			{
				query: {sfollow($dynamics,																								
						
						{sfollow(orn("по причине", "в связи", "в результате", "за счет", stem(short, "обусловлено", связан)),	
								
								 position(1, ., mode:=backward, scope:=sentence),												
								
								 match:=range)}:reason
				)}:m

		result: Результат = $m 
			attribute: Налог = toentity(Динамика,$dynamics, field:=Налог)
			attribute: Изменение = toentity(Динамика,$dynamics, field:=Изменение) 
			attribute: Процент = toentity(Динамика,$dynamics, field:=Процент) 
			attribute: Сумма = toentity(Динамика,$dynamics, field:=Сумма)
			attribute: Причина = $reason
			}
	
	rule: В_абзаце
	{
		
		query: {follow(2, $dynamics, 																								  
		
					   {sfollow("на динамику поступлений оказало влияние" or phrase(10, рост or снижение, поступлений, stem(short)),  
								
								position(1, ., mode:=backward, scope:=sentence),													  
								
								match:=range)}:reason
				)}:m

		result: Результат = $m 
			attribute: Налог = toentity(Динамика,$dynamics, field:=Налог)
			attribute: Изменение = toentity(Динамика,$dynamics, field:=Изменение) 
			attribute: Процент = toentity(Динамика,$dynamics, field:=Процент) 
			attribute: Сумма = toentity(Динамика,$dynamics, field:=Сумма)
			attribute: Причина = $reason
	}
}
	```
	 * выполнить узел

### Структура сущности
* **Результат** - общий вывод найденной сущности
* **Налог** - название налога (наследуется из предыдущего этапа через сущность Динамика)
* **Изменение** - характер динамики налоговых поступлений, "Рост" или "Снижение" (наследуется из предыдущего этапа через сущность Динамика)
* **Процент** - процент изменений налоговых поступлений по сравнению с аналогичным периодом прошлого года (наследуется из предыдущего этапа через сущность Динамика)
* **Сумма** - сумма изменений налоговых поступлений (в числовом выражении) по сравнению с аналогичным периодом прошлого года (наследуется из предыдущего этапа через сущность Динамика)
* **Причина** - причина динамики

### Отчет узла
Отчет узла **Извлечение сущностей** выглядит следующим образом:

| Результат | Налог| Изменение| Процент | Сумма| Причина| 
| ------ | ------ | ------ | ------ | ------ | ------ |
|Снизились поступления налогу на прибыль организаций на 1,4 млрд. руб. на 22% в результате снижения средних цен реализации на металлопродукцию | Налог на прибыль организаций | Снижение | 22.0 | 1,400,000,000.0 | в результате снижения средних цен реализации на металлопродукцию |

В тексте подсвечиваются следующие фрагменты:
> **Снизились поступления**  по **налогу на прибыль организаций на  1,4 млрд. руб.**  или на **22%, в результате снижения средних цен реализации на металлопродукцию**.