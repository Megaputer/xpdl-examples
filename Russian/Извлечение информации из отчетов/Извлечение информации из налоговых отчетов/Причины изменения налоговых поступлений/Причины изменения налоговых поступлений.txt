rule: Причины_изменения_налога
{
	//Поиск контекстов, содержащих сущность "Динамика" (т.е. поиск упоминаний динамики налоговых поступлений). 
	query: {entity(Динамика)}:dynamics

	
	rule: В_предложении
	// Поиск предложений с указанием причин динамики, например, фразу, следующую за ключевыми словами "в связи", "по причине", "в результате" и т.д. 
	// Пример:
	// Снизились поступления  по налогу на прибыль организаций на  1,4 млрд. руб.  или на 22%, в результате снижения средних цен реализации на металлопродукцию.
	{
		query: {sfollow($dynamics,																								//СНИЗИЛИСЬ ПОСТУПЛЕНИЯ  по НАЛОГУ НА ПРИБЫЛЬ ОРГАНИЗАЦИЙ НА  1,4 МЛРД. РУБ.  или на 22%, 		
						
						{sfollow(orn("по причине", "в связи", "в результате", "за счет", stem(short, "обусловлено", связан)),	//В РЕЗУЛЬТАТЕ
								
								 position(1, ., mode:=backward, scope:=sentence),												//СНИЖЕНИЯ СРЕДНИХ ЦЕН  РЕАЛИЗАЦИИ НА МЕТАЛЛОПРОДУКЦИЮ.
								 //Возвращает последнее  слово (position(1, ., mode:=backward)) в предложении (scope:=sentence)).
								
								 match:=range)}:reason
								 //Возвращает всю последовательность от первого до последнего элемента запроса, в нашем случае от слов "по причине" и т.д. до последнего слова в предложении.
				)}:m

		result: Результат = $m // Вывод в колонку "Результат" именованной группы "m".
			attribute: Налог = toentity(Динамика,$dynamics, field:=Налог) // Вывод атрибута "Налог" сущности "Динамика" и замена найденного стандартным именем сущности с помощью функции нормализации toentity(). 
			attribute: Изменение = toentity(Динамика,$dynamics, field:=Изменение) // Вывод атрибута "Изменение" сущности "Динамика" и замена найденного стандартным именем сущности с помощью функции нормализации toentity(). 
			attribute: Процент = toentity(Динамика,$dynamics, field:=Процент) // Вывод атрибута "Процент" сущности "Динамика" и замена найденного стандартным именем сущности с помощью функции нормализации toentity(). 
			attribute: Сумма = toentity(Динамика,$dynamics, field:=Сумма) //Вывод атрибута "Сумма" сущности "Динамика" и замена найденного стандартным именем сущности с помощью функции нормализации toentity(). 
			attribute: Причина = $reason // Вывод в колонку "Причина" именованной группы "reason".
	}
	
	
	rule: В_абзаце
	{
		// Поиск контекстов с указанием причин динамики в пределах двух предложений от упоминания динамики. К примеру, возможна следующая конструкция: По налогу [название налога] поступления увеличились на [сумма]. Рост поступлений  обусловлен [причина].
		// Пример:
		// Налога на имущество организаций поступило 2 763,2 млн. рублей, что превышает поступления налога за аналогичный период прошлого года на 843,3 млн. рублей, или на 105,2 процента. Рост поступлений обусловлен отсутствием переходящих платежей по налогу на имущество организаций за истекший налоговый период (срок уплаты – 30 апреля) на май 2020 года.
		query: {follow(2, $dynamics, 																								  //НАЛОГА НА ИМУЩЕСТВО ОРГАНИЗАЦИЙ поступило 2 763,2 млн. рублей, что ПРЕВЫШАЕТ ПОСТУПЛЕНИЯ налога за аналогичный период прошлого года НА 843,3 МЛН. РУБЛЕЙ, или НА 105,4 ПРОЦЕНТА. 
		
					   {sfollow("на динамику поступлений оказало влияние" or phrase(10, рост or снижение, поступлений, stem(short)),  //РОСТ ПОСТУПЛЕНИЙ ОБУСЛОВЛЕН 
						//Поиск в пределах предложения ключевых слов "на динамику поступлений оказало влияние", "рост" и т.д.																										
								position(1, ., mode:=backward, scope:=sentence),													  //ОТСУТСТВИЕМ ПЕРЕХОДЯЩИХ ПЛАТЕЖЕЙ ПО НАЛОГУ НА ИМУЩЕСТВО ОРГАНИЗАЦИЙ ЗА ИСТЕКШИЙ НАЛОГОВЫЙ ПЕРИОД (СРОК УПЛАТЫ – 30 АПРЕЛЯ) НА МАЙ 2020 ГОДА.	
								//Возвращает последнее  слово (position(1, ., mode:=backward)) в предложении (scope:=sentence)).	
								match:=range)}:reason
								//Возвращает всю последовательность от первого до последнего элемента запроса, в нашем случае от слов "на динамику поступлений оказало влияние" и т.д. до последнего слова в предложении.
				)}:m

		result: Результат = $m // Вывод в колонку "Результат" именованной группы "m".
			attribute: Налог = toentity(Динамика,$dynamics, field:=Налог) // Вывод атрибута "Налог" сущности "Динамика" и замена найденного стандартным именем сущности с помощью функции нормализации toentity(). 
			attribute: Изменение = toentity(Динамика,$dynamics, field:=Изменение) // Вывод атрибута "Изменение" сущности "Динамика" и замена найденного стандартным именем сущности с помощью функции нормализации toentity(). 
			attribute: Процент = toentity(Динамика,$dynamics, field:=Процент) // Вывод атрибута "Процент" сущности "Динамика" и замена найденного стандартным именем сущности с помощью функции нормализации toentity(). 
			attribute: Сумма = toentity(Динамика,$dynamics, field:=Сумма) //Вывод атрибута "Сумма" сущности "Динамика" и замена найденного стандартным именем сущности с помощью функции нормализации toentity(). 
			attribute: Причина = $reason // Вывод в колонку "Причина" именованной группы "reason".
	}
}